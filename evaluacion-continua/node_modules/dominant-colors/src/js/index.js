/* eslint-disable no-param-reassign */
const { useJimp } = require('./get-colors.js');
const { groupColors, findDominantColors } = require('./group-colors.js');

/**
 * @param {string} url - path to the image
 * @param {number} maxColorNumber - maximum number of dominant colors to be returned
 */
async function showColors(url, maxColorNumber) {
  // maxColorNumber parameter check
  if (maxColorNumber === null || maxColorNumber <= 0 || maxColorNumber > 12 || typeof maxColorNumber !== 'number') {
    maxColorNumber = 12;
  }

  try {
    const rgbaCodes = await useJimp(url);

    const groupedHslColors = groupColors(rgbaCodes, 12);

    let dominantColors = findDominantColors(groupedHslColors, 1);

    if (maxColorNumber <= dominantColors.length) {
      dominantColors = dominantColors.slice(
        dominantColors.length - maxColorNumber,
        dominantColors.length
      );
    } else {
      dominantColors = findDominantColors(groupedHslColors, 0);
      dominantColors =
        dominantColors.length > maxColorNumber
          ? dominantColors.slice(dominantColors.length - maxColorNumber, dominantColors.length)
          : dominantColors;
    }

    return dominantColors;
  } catch (e) {
    return 'Please enter a correct path to the image';
  }
}

exports.showColors = showColors;
