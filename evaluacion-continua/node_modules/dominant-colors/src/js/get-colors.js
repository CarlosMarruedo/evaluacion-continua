const Jimp = require('jimp');

function useJimp(url) {
  return Jimp.read(url)
    .then(b => {
      const colorCodes = [];
      b.scan(0, 0, b.bitmap.width, b.bitmap.height, function(x, y, idx) {
        // x, y is the position of this pixel on the image
        // idx is the start position of this rgba tuple in the bitmap Buffer
        
        const red = +this.bitmap.data[idx + 0];
        const green = +this.bitmap.data[idx + 1];
        const blue = +this.bitmap.data[idx + 2];
        const alpha = +(this.bitmap.data[idx + 3])/255;
  
        colorCodes.push({ red, green, blue, alpha });
      });
  
      return colorCodes;
    });
}

exports.useJimp = useJimp;
